import { StickyHeader } from "./StickyHeader"
import { ContentZone } from "./ContentZone"
import Head from 'next/head'
import Image from 'next/image'
import { useState, createContext, useRef, useEffect } from "react"
import { MobileNav } from "./MobileNav"
import Script from "next/script"
import { MobileUserPanel } from "./MobileUserPanel"
import { faAngleUp } from "@fortawesome/free-solid-svg-icons"
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome"
import { motion } from "framer-motion"

const MyChattanoogaContext = createContext();

const childrenComponentVariants = {
    normal: {y: "0%"},
    extended: {y: "4rem"}
}

const userPanelVariants = {
    open: { opacity: .9, y: "0%" },
    closed: { opacity: 0, y: "0%"  },
}

export const MyChattanoogaProvider = ({ children }) => {

    const [menuExpanded, setMenuExpanded] = useState(false);
    const [panelExpanded, setPanelExpanded] = useState(false);
    const [isDark, setDark] = useState(false);
    const [weatherData, setWeatherData] = useState(null);
    const [defaultWeatherLocation, setDefaultWeatherLocation] = useState(null);
    const [settingsPannelExpanded, setSettingsPanelExpanded] = useState(false);

    function toggleMobileNav() {
        setMenuExpanded(menuExpanded => !menuExpanded)
    }
    function toggleMobileUserPanel() {
        setPanelExpanded(panelExpanded => !panelExpanded)
    }
    function toggleDarkMode() {
        setDark(isDark => !isDark);
        document.body.classList.contains('dark') 
            ? document.body.classList.remove("dark") 
            : document.body.classList.add("dark");
    }

    const value = {
        isExpanded: {menuExpanded},
        toggleMobileNav: {toggleMobileNav},
        panelExpanded: {panelExpanded},
        toggleMobileUserPanel: {toggleMobileUserPanel},
        toggleDarkMode: {toggleDarkMode},
        settingsPannelExpanded: {settingsPannelExpanded},
        setSettingsPanelExpanded: {setSettingsPanelExpanded}
    }

    const childrenWrapperClassString = (menuExpanded === true) 
        ? "transition duration-[250ms] blur-sm ease-linear h-fit"
        : "transition duration-[500ms] h-fit"

    return (
        <MyChattanoogaContext.Provider value={value}>
            <div className="flex flex-col h-screen overscroll-contain bg-[#FFF] dark:bg-[#222]">
                <Head>
                        <title>myChattanooga</title>
                        <meta name="description" content="Generated by create next app" key="siteDescription"/>
                        <link rel="icon" href="/favicon.ico" /> 
                </Head>

                <header className="w-screen shadow-sm bg-[#FFF] dark:bg-[#222] z-50">
                    <StickyHeader isDark={isDark} />
                </header>

                <main className="w-screen h-screen align-center relative overflow-y-scroll" key="siteContent">
                    {/* TECH DEBT: Put motion element here instead of in MobileNav component */}
                    <div className="sm:hidden fixed w-full h-fit object-center -left-full z-50 flex mx-auto" key="MobileNav">
                        <MobileNav isDark={isDark} menuExpanded={menuExpanded} setMenuExpanded={setMenuExpanded}/>
                    </div>
                    <motion.div 
                        className="sm:hidden w-full h-0 object-center sticky -top-0 z-30 mx-auto" 
                        key="MobileUserPanel"
                        animate={panelExpanded===true ? 'open' : 'closed'}
                        transition={{ 
                            duration: panelExpanded===true ? .3 : .3, 
                            type: "tween"
                        }}
                        variants={userPanelVariants}
                    >
                        <MobileUserPanel 
                            isDark={isDark} 
                            panelExpanded={panelExpanded} 
                            toggleDarkMode={toggleDarkMode}
                        />
                    </motion.div>
                    <div className={childrenWrapperClassString}>
                        <motion.div 
                            animate={panelExpanded===true ? 'extended' : 'normal'}
                            className="overscroll-contain scroll-smooth p-6 lg:px-8 lg:pt-8"
                            transition={{ 
                                duration: panelExpanded===true ? .3 : .5,
                                type: "tween"
                            }}
                            variants={childrenComponentVariants}
                        >
                            {children}
                        </motion.div>
                    </div>
                </main>

                {/* <footer className="flex items-center w-screen">
                    
                    <div className="flex-auto">
                        Hi
                    </div>
                        
                </footer> */}
            </div>
        </MyChattanoogaContext.Provider>
    )
}

export default MyChattanoogaContext
